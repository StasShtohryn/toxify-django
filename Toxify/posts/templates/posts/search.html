{% extends 'main/base.html' %}

{% block title %}Пошук — Toxify{% endblock %}

{% block content %}
<div class="p-4">
    <form method="get" action="{% url 'search' %}">
        <div class="relative">
            <svg class="absolute left-3 top-1/2 -translate-y-1/2 text-white/40" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input
                type="text"
                name="q"
                value="{{ query }}"
                placeholder="#хештег, @юзернейм або текст..."
                autocomplete="off"
                class="w-full bg-white/5 border border-white/10 py-3 pl-10 pr-4 text-sm focus:outline-none focus:border-white/30 transition-colors text-white"
            />
        </div>
    </form>

    {% if query %}
        {% if search_type == 'hashtag' %}
            <div class="mt-4 mb-2 text-xs text-white/40">
                Пости з хештегом <span class="text-white/70 font-bold">{{ query }}</span>
            </div>
        {% elif search_type == 'mention' %}
            <div class="mt-4 mb-2 text-xs text-white/40">
                Профілі за запитом <span class="text-white/70 font-bold">{{ query }}</span>
            </div>
        {% endif %}

        <!-- Профілі -->
        {% if profiles %}
            <div class="mt-6 mb-2 text-xs font-bold text-white/40 uppercase tracking-wider">Профілі</div>
            {% for profile in profiles %}
                <a href="{% url 'profile_detail' profile.user.username %}" class="flex items-center gap-3 p-3 hover:bg-white/[0.03] transition-colors border-b border-white/10">
                    <img
                        src="{% if profile.avatar %}{{ profile.avatar.url }}{% endif %}"
                        alt=""
                        class="w-10 h-10 border border-white/20 object-cover bg-white/5"
                    />
                    <div>
                        <div class="font-bold text-sm">{{ profile.user.username }}</div>
                        {% if profile.bio %}
                            <div class="text-xs text-white/40 truncate max-w-xs">{{ profile.bio }}</div>
                        {% endif %}
                    </div>
                </a>
            {% endfor %}
        {% endif %}

        <!-- Пости -->
        {% if posts %}
            <div class="mt-6 mb-2 text-xs font-bold text-white/40 uppercase tracking-wider">Пости</div>
            {% for post in posts %}
                <div class="border-b border-white/10 p-4 hover:bg-white/[0.02] transition-colors flex gap-3">
                    <a href="{% url 'profile_detail' post.userProfile.user.username %}" class="shrink-0">
                        <img
                            src="{% if post.userProfile.avatar %}{{ post.userProfile.avatar.url }}{% endif %}"
                            alt=""
                            class="w-10 h-10 border border-white/20 object-cover bg-white/5"
                        />
                    </a>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <a href="{% url 'profile_detail' post.userProfile.user.username %}" class="font-bold text-sm hover:underline">{{ post.userProfile.user.username }}</a>
                            <span class="text-white/40 text-xs">{{ post.created_at|timesince }} тому</span>
                        </div>
                        {% if post.title %}
                            <div class="text-sm font-medium mb-1">{{ post.title }}</div>
                        {% endif %}
                        {% if post.body %}
                            <p class="text-sm text-white/80 line-clamp-3">{{ post.body }}</p>
                        {% endif %}
                        {% if post.hashtags.all %}
                            <div class="flex flex-wrap gap-2 mt-2">
                                {% for tag in post.hashtags.all %}
                                    <a href="{% url 'search' %}?q=%23{{ tag.name }}" class="text-xs text-white/50 hover:text-white/80 transition">#{{ tag.name }}</a>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% endif %}

        {% if not profiles and not posts %}
            <div class="mt-12 text-center text-white/30 text-sm">
                Нічого не знайдено по запиту «{{ query }}»
            </div>
        {% endif %}
    {% endif %}
</div>
{% endblock %}